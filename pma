#!/bin/bash
# ________  _____ ______   ________     
#|\   __  \|\   _ \  _   \|\   __  \    
#\ \  \|\  \ \  \\\__\ \  \ \  \|\  \   
# \ \   ____\ \  \\|__| \  \ \   __  \  
#  \ \  \___|\ \  \    \ \  \ \  \ \  \ 
#   \ \__\    \ \__\    \ \__\ \__\ \__\
#    \|__|     \|__|     \|__|\|__|\|__|
# Plugin MAnager
# v2dev
# LICENSED UNDER MIT

DIR="/the/path/of/plugins/folder"
QUERY=`echo $2 | sed 's/ /+/'g`
RESULT=`curl -s https://pluginmanagerr.github.io/pma-repo/vizality.json | jq -r  ".pma."$QUERY"_link"`

if ! [ -x "$(command -v jq)" ]; then
    echo "jq is not installed, attempting to install it"
    sudo pacman -S jq
    sudo apt install jq
    sudo emerge -a jq --autounmask
    sudo zypper install jq
    echo "If it didnt work install  jq manually"
fi

if ! [ -x "$(command -v curl)" ]; then
    echo "curl is not installed, attempting to install it"
    sudo pacman -S curl
    sudo apt install curl 
    sudo zypper install curl
    sudo emerge -a curl --autounmask
    echo "If it didnt work install  curl manually"
fi

if ! [ -x "$(command -v git)" ]; then
    echo "git is not installed, attempting to install it"
    sudo pacman -S git
    sudo apt install git 
    sudo zypper install git
    sudo emerge -a git --autounmask
    echo "If it didnt work install  git manually"
fi


_print_help(){
  cat << "EOF"
Usage:  pma [OPTIONS]
Options:
    -i  --info        Info of a plugin
    -l  --list        List of plugins
    -h  --help        Show help
    -v  --version     Show version
    -f  --fetch       Fetch a plugin
EOF
}

POSITIONAL=()
while [[ $# -gt 0 ]]; do
    case $1 in
         --list|-l)
          curl -s https://pluginmanagerr.github.io/pma-repo/vizality.json | jq -r  ".pma"
            shift
            shift
            ;;
           --version|-v)
           echo '
 ________  _____ ______   ________     
|\   __  \|\   _ \  _   \|\   __  \    
\ \  \|\  \ \  \\\__\ \  \ \  \|\  \   
 \ \   ____\ \  \\|__| \  \ \   __  \  
  \ \  \___|\ \  \    \ \  \ \  \ \  \ 
   \ \__\    \ \__\    \ \__\ \__\ \__\
    \|__|     \|__|     \|__|\|__|\|__|'              
            echo "v2dev"
            echo "please dont use this thank u veri mach"
            echo "WARNING:MAY CONTAIN SHIT CODE"
            echo "pma is open source, you can check the repos here:"
            echo "https://github.com/pluginmanagerr/pma"
            echo "https://github.com/pluginmanagerr/pma-repo"
            shift
            ;;
          --fetch|-f)
           cd $DIR
           git clone --progress --quiet $RESULT 
            shift
            shift
            ;;
          --info|-i)
           curl -s https://pluginmanagerr.github.io/pma-repo/vizality.json | jq -r --arg QUERY "$QUERY"  ".pma.$QUERY"
            shift
            shift
            ;;
        --help|-h)
            _print_help
            shift
            shift
            ;;
        *)
          echo "Option not found"
          _print_help
          shift
          ;;
    esac
done
